---
title: "Untitled"
author: "Muyao GUO"
date: "2025-09-29"
output: html_document
---

```{r setup, include=FALSE}
# 1ä¸ªcontinueï¼Œ3ä¸ªdiscreteçš„variables

Donnees_mammographic=read.table("mammographic.data",header=T)
summary(Donnees_mammographic)
# densityé‡Œé¢æœ‰æ•°æ®ï¼Œ1å’Œ4çš„æ•°æ®å¤ªå°‘äº†ï¼Œå¯èƒ½ä¼šå½±å“ç»“æžœ
tumeur = within(Donnees_mammographic,{
  age = age
  shape = factor(shape)
  margin = factor(margin)
  density = factor(density)
  Y = factor(Y)
})
summary(tumeur)
library(rpart)
library(rpart.plot)
trpart=rpart(Y~., data = tumeur)
plot(trpart)
text(trpart)
print(trpart) 
#1) root 830 403 0 (0.5144578 0.4855422)    ä¸€å…±æœ‰830ä¸ªç»“æžœï¼Œ430ä¸ªmaligneï¼Œå¤§å¤šæ•°æ˜¯0
#  2) margin=1 320  38 0ï¼ˆä¸»è¦åˆ†ç±»æ˜¯0ï¼‰ (0.8812500 0.1187500) *    æœ‰320ä¸ªç»“æžœï¼Œå¸¦â€œ*â€ä»£è¡¨feuilleã€‚å¦‚æžœmargin = 1ï¼Œè¿™é‡Œæ˜¯aï¼Œè¿›å·¦åˆ†æ”¯ã€‚
# åœ¨æ ‘é‡Œé¢ã€‚ç¬¦åˆæ¡ä»¶è¿›å·¦åˆ†æ”¯ï¼Œä¸ç¬¦åˆè¿›å³åˆ†æ”¯
# 15) age>=53.5 338  60ï¼ˆè¿™æ˜¯è¯¥èŠ‚ç‚¹é‡Œçš„â€œé”™è¯¯æ ·æœ¬æ•°â€ï¼ˆmisclassified casesï¼‰ï¼‰ 1 (0.1775148 0.8224852) * è¿™æ˜¯èŠ‚ç‚¹å†…å„ç±»åˆ«çš„æ¯”ä¾‹ï¼ˆæ¦‚çŽ‡åˆ†å¸ƒï¼‰,0å æ¯”0.177

# å¦ä¸€ç§æ–¹æ³•ç»˜åˆ¶tree
rpart.plot(trpart)
# è¿™é‡Œæ²¡æœ‰noeud pureï¼Œæ‰€ä»¥è¿™ä¸ªä¸æ˜¯arbre maximal
# --ã€‹  1.ç”¨æ­£ç¡®çš„å‚æ•°ã€‚ 2.ç”¨cpã€‚parametre de complecite


help("rpart")
help("rpart.control")  # cp = 0 å¾—åˆ°arbre maximalã€‚ åœ¨å»ºæ ‘æ—¶ 
```
ä¸åšä»»ä½•å‰ªæžï¼Œè®©æ ‘å°½å¯èƒ½åˆ†è£‚ä¸‹åŽ»ï¼Œç›´åˆ°ä¸èƒ½å†åˆ†
ä¸ºä»€ä¹ˆ cp = 0 å°±ä¼šå¾—åˆ°æœ€å¤§æ ‘ï¼Ÿ
åœ¨ rpart é‡Œï¼Œåˆ†è£‚æ—¶çš„è§„åˆ™æ˜¯ï¼š
åªæœ‰å½“åˆ†è£‚èƒ½å‡å°‘çš„ä¸çº¯åº¦ > cp Ã— (æ€»æ ·æœ¬æ•°)ï¼Œæ‰ä¼šè¢«æŽ¥å—ã€‚
å¦‚æžœä½ è®¾ç½® cp = 0ï¼š
åˆ†è£‚åªè¦èƒ½å¸¦æ¥å“ªæ€•ä¸€ç‚¹ç‚¹æ”¹è¿›ï¼Œå°±ä¼šå‘ç”Ÿã€‚
æ‰€ä»¥æ ‘ä¼šæ— é™åˆ¶ç”Ÿé•¿ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•å¯èƒ½çš„åˆ†è£‚ã€‚
å¾—åˆ°çš„å°±æ˜¯ arbre maximalã€‚
minsplit:åœ¨æŸä¸ªèŠ‚ç‚¹ä¸Šï¼Œæœ€å°‘éœ€è¦å¤šå°‘ä¸ªæ ·æœ¬æ‰èƒ½å°è¯•åˆ†è£‚

## Arbre maximal

```{r cars}
tMax = rpart(Y~.,data=tumeur,control = rpart.control(cp = 0,minsplit = 3))
rpart.plot(tMax)

```



## Vadidation croisee

```{r pressure, echo=FALSE}
printcp(tMax)
```
ä¸€ä¸ªå¥½çš„arbreç”±validation croiseeç¡®å®šã€‚
CPï¼šåˆ†è£‚é˜ˆå€¼ï¼ˆæŽ§åˆ¶å‰ªæžï¼‰ã€‚
nsplitï¼šåˆ†è£‚æ¬¡æ•°ã€‚æ ‘ä¸­å·²ç»è¿›è¡Œçš„åˆ†è£‚æ¬¡æ•°, leaf_count=nsplit+1
rel errorï¼šè®­ç»ƒè¯¯å·®ï¼ˆå½’ä¸€åŒ–ï¼‰ã€‚erreur d'apprentissage.æ ¹èŠ‚ç‚¹çš„ erreur d'apprentissage =        1,åˆ†è£‚è¶Šå¤šï¼Œè®­ç»ƒè¯¯å·®è¶Šå°ï¼Œæœ€ç»ˆåœ¨æœ€å¤§æ ‘ï¼ˆarbre maximalï¼‰ä¸Šç”šè‡³å¯èƒ½æŽ¥è¿‘ 0ï¼ˆè¿‡æ‹Ÿåˆï¼‰ã€‚
xerrorï¼šäº¤å‰éªŒè¯è¯¯å·®ï¼ˆæ³›åŒ–èƒ½åŠ›ï¼‰ã€‚qui estime erreur de generalisation æ˜¯Uå½¢å›¾
å’Œ erreur dâ€™apprentissage çš„å…³ç³»
è®­ç»ƒè¯¯å·® (apprentissage)ï¼šåœ¨è®­ç»ƒé›†ä¸Šï¼Œæ€»æ˜¯å¯ä»¥é€šè¿‡å¢žåŠ å¤æ‚åº¦é™ä½Žã€‚
æ³›åŒ–è¯¯å·® (gÃ©nÃ©ralisation)ï¼šåœ¨æµ‹è¯•é›†ä¸Šï¼Œéšç€æ¨¡åž‹å¤æ‚åº¦çš„å˜åŒ–é€šå¸¸å‘ˆ U åž‹æ›²çº¿ï¼š
xstdï¼šäº¤å‰éªŒè¯è¯¯å·®çš„æ³¢åŠ¨ã€‚äº¤å‰éªŒè¯çš„ecart-type

ðŸ“Œ ä¸€èˆ¬åšæ³•ï¼š
printcp() çœ‹è¡¨ï¼Œplotcp() ç”»å›¾ã€‚
æ‰¾åˆ° xerror æœ€å°å€¼ã€‚
å†ç”¨ 1-SE è§„åˆ™ é€‰ä¸€ä¸ªå°½å¯èƒ½ç®€å•çš„æ ‘ï¼ˆåœ¨æœ€å° xerror + xstd å†…é€‰æ‹©æœ€å°çš„ nsplitï¼‰ã€‚

```{r }
plotcp(tMax)

```
ðŸ”¹ å›¾é‡Œæœ‰ä»€ä¹ˆï¼Ÿ

æ¨ªè½´ï¼šæ ‘çš„å¤æ‚åº¦å‚æ•° cpï¼ˆæˆ–ç­‰ä»·åœ°ï¼Œåˆ†è£‚æ¬¡æ•° nsplitï¼‰ã€‚
è¶Šå¾€å·¦ï¼Œæ ‘è¶Šå¤æ‚ï¼ˆcp è¶Šå°ï¼Œåˆ†è£‚è¶Šå¤šï¼‰ã€‚
è¶Šå¾€å³ï¼Œæ ‘è¶Šç®€å•ï¼ˆcp è¶Šå¤§ï¼Œåˆ†è£‚è¶Šå°‘ï¼‰ã€‚
çºµè½´ï¼šäº¤å‰éªŒè¯è¯¯å·® (xerror)ã€‚
æ›²çº¿æ˜¾ç¤ºè¯¯å·®éšæ ‘å¤æ‚åº¦çš„å˜åŒ–è¶‹åŠ¿ã€‚
ç‚¹ï¼šäº¤å‰éªŒè¯ç»“æžœï¼Œæ¯ä¸ªç‚¹å¯¹åº” printcp() è¡¨é‡Œçš„ä¸€ä¸ªè¡Œã€‚
ç«–çº¿ï¼šè¯¯å·®æ¡ï¼ˆxstdï¼‰ï¼Œæ˜¾ç¤ºäº¤å‰éªŒè¯è¯¯å·®çš„æ ‡å‡†å·®ã€‚

ðŸ”¹ ç”¨æ¥å¹²å˜›ï¼Ÿ

ç›´è§‚åœ°æ‰¾åˆ° æœ€ä¼˜å‰ªæžç‚¹ï¼š
è¯¯å·®æœ€å°çš„ç‚¹ï¼šæ³›åŒ–æœ€å¥½ã€‚ä¸€èˆ¬æ¥è¯´é€‰å›¾ä¸­çš„æœ€ä½Žç‚¹ï¼ˆminimumï¼‰ä½œä¸ºCART
1-SE è§„åˆ™ï¼šé€‰æ‹©åœ¨â€œæœ€å°è¯¯å·® + 1 ä¸ªæ ‡å‡†å·®â€ä»¥å†…çš„æœ€ç®€å•çš„æ ‘ã€‚è‹¥minimulå¤ªè¿œäº†ï¼Œè¿ç”¨è¿™ä¸ªæ³•åˆ™ã€‚è™šçº¿ä¸‹çš„ç¬¬ä¸€ä¸ª

å›¾ä¸­çš„è™šçº¿ï¼šmin(xerror + xstd),è®¤ä¸ºåœ¨è™šçº¿ä¹‹ä¸‹çš„variance est equivalent



## Pruning
```{r pruning}
tcart = prune(tMax,cp=0.01116625)
rpart.plot(tcart)

tMax$cptable[which.max(tMax$cptable[,4]),1]
which.min(tMax$cptable[,4])

```

3  0.01116625      2   0.40447 0.40943 0.028530

## Prediction
```{r prediction}
rpart.plot(tcart)
predict(tcart, newdata = data.frame(age = 50, shape = '3', margin = '2',density = '1'))
```
äººå·¥è‡ªå·±è¯»ä¸€é age = 50, shape = 3, margin = 2,density = 1   --> Tumeur 0 benign: 0.32 è¿™é‡Œçš„æ¦‚çŽ‡å†™çš„ä¸€ç›´æ˜¯Proba Y=1çš„æ¦‚çŽ‡ï¼ï¼ é”™è¯¯çš„å 32%
Predict ç»“æžœï¼š
     0    1
1 0.68 0.32


## Performance l'arbre CART
```{r logit}
K=10
ind_fold=sample(1:K,nrow(tumeur),replace=TRUE)
ind_fold
table(ind_fold)
error=numeric(K)
error
for (j in 1:K)
{
 fit.glm=glm(Y~.,data=tumeur[ind_fold!=j,],family = binomial)       # ä¸å±žäºŽind_fold ç¬¬jä¸ªæ ¼å­çš„æ•°æ®é›†ï¼Œä½œä¸ºdata_train
  y.glm=predict(fit.glm,newdata=tumeur[ind_fold==j,], type = "response")   # å±žäºŽind_fold ç¬¬jä¸ªæ ¼å­çš„æ•°æ®é›†ï¼Œä½œä¸ºdata_test
  y.test=tumeur[ind_fold==j,"Y"]
  pred = rep(0,length(y.test))
  pred[y.glm>0.5] = 1  
  error[j]= mean(y.test != pred)
}

CVerror= mean(error) 
CVerror   #  0.18922


pred_Cart = predict(tcart,tumeur)
pred_Cart[>0.5] = 1

```


